<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quá trình Công tác</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"><i class="fas fa-users-cog"></i> HRM System</a>
        <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="/">Trang chủ</a></li>
            <li class="nav-item"><a class="nav-link" href="/logout">Đăng xuất</a></li>
        </ul>
    </div>
</nav>

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
            <h4><i class="fas fa-history"></i> Quá trình Công tác</h4>
        </div>
        <div class="card-body">
            <div th:if="${employeeName}" class="alert alert-info">
                <i class="fas fa-user me-2"></i>
                <strong>Nhân viên:</strong> <span th:text="${employeeName}"></span>
            </div>

            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <span th:text="${errorMessage}">Có lỗi xảy ra.</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <form th:action="@{/workhistories/save}" th:object="${workHistory}" method="post">
                <input type="hidden" th:field="*{id}">
                <input type="hidden" th:field="*{employeeId}">

                <!-- Thông tin vị trí công tác -->
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <h5 class="border-bottom pb-2 text-success">
                            <i class="fas fa-briefcase"></i> Thông tin Vị trí
                        </h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="fas fa-building"></i> Phòng ban *
                        </label>
                        <select class="form-select"
                                th:field="*{departmentId}"
                                th:classappend="${#fields.hasErrors('departmentId')} ? ' is-invalid' : ''">
                            <option value="">-- Chọn phòng ban --</option>
                            <option th:each="dept : ${departments}"
                                    th:value="${dept.id}"
                                    th:text="${dept.departmentName}"></option>
                        </select>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('departmentId')}" th:errors="*{departmentId}"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="fas fa-crown"></i> Chức vụ *
                        </label>
                        <select class="form-select"
                                th:field="*{positionId}"
                                th:classappend="${#fields.hasErrors('positionId')} ? ' is-invalid' : ''">
                            <option value="">-- Chọn chức vụ --</option>
                            <option th:each="pos : ${positions}"
                                    th:value="${pos.id}"
                                    th:text="${pos.positionName}"></option>
                        </select>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('positionId')}" th:errors="*{positionId}"></div>
                    </div>
                </div>

                <!-- Thời gian công tác -->
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <h5 class="border-bottom pb-2 text-success">
                            <i class="fas fa-calendar-alt"></i> Thời gian Công tác
                        </h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="fas fa-calendar-check"></i> Ngày bắt đầu *
                        </label>
                        <input type="date" class="form-control"
                               th:field="*{startDate}"
                               th:classappend="${#fields.hasErrors('startDate')} ? ' is-invalid' : ''"
                               required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="fas fa-calendar-times"></i> Ngày kết thúc
                        </label>
                        <input type="date" class="form-control"
                               th:field="*{endDate}"
                               th:classappend="${#fields.hasErrors('endDate')} ? ' is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}"></div>
                        <small class="text-muted">Để trống nếu còn đang làm việc</small>
                    </div>
                </div>

                <!-- Nghỉ phép -->
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <h5 class="border-bottom pb-2 text-success">
                            <i class="fas fa-umbrella-beach"></i> Nghỉ phép
                        </h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">
                            <i class="fas fa-bed"></i> Loại nghỉ phép
                        </label>
                        <select class="form-select"
                                th:field="*{leaveType}"
                                th:classappend="${#fields.hasErrors('leaveType')} ? ' is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('leaveType')}" th:errors="*{leaveType}"></div>
                            <option value="">-- Không nghỉ --</option>
                            <option value="Nghỉ phép năm">Nghỉ phép năm</option>
                            <option value="Nghỉ ốm">Nghỉ ốm</option>
                            <option value="Nghỉ thai sản">Nghỉ thai sản (4-6 tháng)</option>
                            <option value="Nghỉ dưỡng thai">Nghỉ dưỡng thai</option>
                            <option value="Nghỉ không lương">Nghỉ không lương</option>
                            <option value="Nghỉ việc riêng">Nghỉ việc riêng</option>
                            <option value="Nghỉ hiếu">Nghỉ hiếu</option>
                            <option value="Nghỉ hỷ">Nghỉ hỷ</option>
                            <option value="Nghỉ học">Nghỉ học</option>
                        </select>
                        <small class="text-muted">
                            Nghỉ phép năm: 12 ngày/năm | Nghỉ ốm: Theo chỉ định BS | Thai sản: 4-6 tháng
                        </small>
                    </div>
                </div>

                <!-- Khen thưởng và Kỷ luật -->
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <h5 class="border-bottom pb-2 text-success">
                            <i class="fas fa-trophy"></i> Khen thưởng & Kỷ luật
                        </h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="fas fa-medal"></i> Khen thưởng
                        </label>
                        <select class="form-select"
                                th:field="*{rewardType}"
                                th:classappend="${#fields.hasErrors('rewardType')} ? ' is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('rewardType')}" th:errors="*{rewardType}"></div>
                            <option value="">-- Không có --</option>
                            <option value="Giấy khen">Giấy khen</option>
                            <option value="Bằng khen">Bằng khen</option>
                            <option value="Huân chương lao động Hạng Ba">Huân chương lao động Hạng Ba</option>
                            <option value="Huân chương lao động Hạng Nhì">Huân chương lao động Hạng Nhì</option>
                            <option value="Huân chương lao động Hạng Nhất">Huân chương lao động Hạng Nhất</option>
                            <option value="Chiến sĩ thi đua cấp cơ sở">Chiến sĩ thi đua cấp cơ sở</option>
                            <option value="Chiến sĩ thi đua cấp Bộ">Chiến sĩ thi đua cấp Bộ</option>
                            <option value="Chiến sĩ thi đua toàn quốc">Chiến sĩ thi đua toàn quốc</option>
                            <option value="Lao động tiên tiến">Lao động tiên tiến</option>
                            <option value="Tập thể lao động tiên tiến">Tập thể lao động tiên tiến</option>
                            <option value="Thưởng học tập">Thưởng học tập</option>
                            <option value="Thưởng dự án">Thưởng dự án</option>
                            <option value="Thưởng đột xuất">Thưởng đột xuất</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="fas fa-exclamation-triangle"></i> Kỷ luật
                        </label>
                        <select class="form-select"
                                th:field="*{disciplineType}"
                                th:classappend="${#fields.hasErrors('disciplineType')} ? ' is-invalid' : ''">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('disciplineType')}" th:errors="*{disciplineType}"></div>
                            <option value="">-- Không có --</option>
                            <option value="Khiển trách">Khiển trách</option>
                            <option value="Cảnh cáo">Cảnh cáo</option>
                            <option value="Hạ bậc lương">Hạ bậc lương</option>
                            <option value="Cách chức">Cách chức</option>
                            <option value="Sa thải">Sa thải</option>
                        </select>
                    </div>
                </div>

                <!-- Ghi chú -->
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <h5 class="border-bottom pb-2 text-success">
                            <i class="fas fa-sticky-note"></i> Ghi chú
                        </h5>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">
                        <i class="fas fa-edit"></i> Ghi chú chi tiết
                    </label>
                    <textarea class="form-control"
                              th:field="*{note}"
                              th:classappend="${#fields.hasErrors('note')} ? ' is-invalid' : ''"
                              rows="4"
                              placeholder="Mô tả chi tiết về quá trình công tác, thuyên chuyển, thay đổi..."></textarea>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('note')}" th:errors="*{note}"></div>
                    <small class="text-muted">
                        VD: Thuyên chuyển từ phòng A sang phòng B, thăng chức, điều động...
                    </small>
                </div>

                <!-- Thông tin hữu ích -->
                <div class="alert alert-info">
                    <h6><i class="fas fa-lightbulb"></i> Hướng dẫn:</h6>
                    <ul class="mb-0">
                        <li><strong>Ghi lại toàn bộ quá trình:</strong> Mọi thay đổi về vị trí, chức vụ đều cần ghi nhận</li>
                        <li><strong>Thời gian chính xác:</strong> Ngày bắt đầu là bắt buộc, ngày kết thúc để trống nếu còn làm</li>
                        <li><strong>Khen thưởng/Kỷ luật:</strong> Ghi rõ hình thức và lý do trong phần ghi chú</li>
                        <li><strong>Nghỉ phép:</strong> Chỉ ghi những kỳ nghỉ dài hạn (từ 1 tháng trở lên)</li>
                    </ul>
                </div>

                <!-- Quy định pháp lý -->
                <div class="card border-warning mb-3">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0"><i class="fas fa-balance-scale"></i> Quy định pháp lý</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Nghỉ phép:</h6>
                                <ul class="small mb-0">
                                    <li>Phép năm: 12 ngày/năm (làm 5 năm +1 ngày)</li>
                                    <li>Nghỉ ốm: Theo giấy nghỉ của bác sĩ</li>
                                    <li>Thai sản: 6 tháng (sinh đơn), 7 tháng (sinh đôi)</li>
                                    <li>Nghỉ hiếu: 3 ngày (cha mẹ, vợ/chồng, con)</li>
                                    <li>Nghỉ hỷ: 3 ngày</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Khen thưởng & Kỷ luật:</h6>
                                <ul class="small mb-0">
                                    <li>Khen thưởng: Cần có quyết định của cấp có thẩm quyền</li>
                                    <li>Kỷ luật: Phải đúng trình tự theo Bộ luật Lao động</li>
                                    <li>Thời hiệu xử lý kỷ luật: 6 tháng kể từ ngày vi phạm</li>
                                    <li>Kỷ luật khiển trách: Có hiệu lực 3 tháng</li>
                                    <li>Kỷ luật cảnh cáo: Có hiệu lực 6 tháng</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="mt-4">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Lưu lại
                    </button>
                    <a th:href="@{/workhistories/employee/{id}(id=${workHistory.employeeId})}"
                       class="btn btn-secondary">
                        <i class="fas fa-times"></i> Hủy
                    </a>
                    <button type="reset" class="btn btn-outline-secondary">
                        <i class="fas fa-redo"></i> Làm mới
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-fill current date for start date if empty
    document.addEventListener('DOMContentLoaded', function() {
        const startDateInput = document.querySelector('input[name="startDate"]');
        if (startDateInput && !startDateInput.value) {
            const today = new Date().toISOString().split('T')[0];
            startDateInput.value = today;
        }
    });
</script>
</body>
</html>